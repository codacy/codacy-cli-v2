# Codacy CLI `config reset` Command Scenarios
 
This document outlines the possible scenarios for the `codacy-cli config reset` command, considering the current CLI mode (as defined in `.codacy/cli-config.yaml`) and the flags provided during the command execution.

| Current CLI Mode (`.codacy/cli-config.yaml`) | `config reset` Flags Provided                                  | Behavior                                                                                                                                                                                                                                                           |
| :------------------------------------------- | :------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Local**                                    | No flags                                                       | Resets configuration to local default settings. Creates/overwrites `.codacy/codacy.yaml` and `tools-configs/` with defaults. `cli-config.yaml` is set to `mode: local`.                                                                                             |
| **Local**                                    | `--api-token <token>`<br>(missing provider/org/repo)            | **Error:** Command exits. Message indicates that `--provider`, `--organization`, and `--repository` are required when `--api-token` is used.                                                                                                                            |
| **Local**                                    | `--api-token <token>`<br>`--provider <p>`<br>`--organization <o>`<br>`--repository <r>` | Fetches repository-specific configurations from Codacy API. Creates/overwrites `.codacy/codacy.yaml` and `tools-configs/` based on API response. `cli-config.yaml` is set to `mode: remote`.                                                           |
| **Remote**                                   | No flags                                                       | **Error:** Command exits. Message indicates that the CLI is in 'remote' mode, and to reset, API flags (`--api-token`, `--provider`, etc.) must be provided. This prevents accidental reset to local defaults.                                                          |
| **Remote**                                   | `--api-token <token>`<br>(missing provider/org/repo)            | **Error:** Command exits. Message indicates that `--provider`, `--organization`, and `--repository` are required when `--api-token` is used.                                                                                                                            |
| **Remote**                                   | `--api-token <token>`<br>`--provider <p>`<br>`--organization <o>`<br>`--repository <r>` | Fetches repository-specific configurations from Codacy API. Creates/overwrites `.codacy/codacy.yaml` and `tools-configs/` based on API response. `cli-config.yaml` remains/is set to `mode: remote`.                                                        |
| File missing or unparseable (`.codacy/cli-config.yaml`) | No flags                                                       | (Defaults to Local mode) Resets configuration to local default settings. Creates/overwrites `.codacy/codacy.yaml` and `tools-configs/` with defaults. `cli-config.yaml` is set to `mode: local`. **User-facing warning printed to console and logged regarding `cli-config.yaml` issue.**         |
| File missing or unparseable (`.codacy/cli-config.yaml`) | `--api-token <token>`<br>(missing provider/org/repo)            | (Defaults to Local mode) **Error:** Command exits. Message indicates that `--provider`, `--organization`, and `--repository` are required when `--api-token` is used. **User-facing warning printed to console and logged regarding `cli-config.yaml` issue.**                                       |
| File missing or unparseable (`.codacy/cli-config.yaml`) | `--api-token <token>`<br>`--provider <p>`<br>`--organization <o>`<br>`--repository <r>` | (Defaults to Local mode) Fetches repository-specific configurations from Codacy API. Creates/overwrites `.codacy/codacy.yaml` and `tools-configs/` based on API response. `cli-config.yaml` is set to `mode: remote`. **User-facing warning printed to console and logged regarding `cli-config.yaml` issue.** |

## Key Points

*   The `runConfigResetLogic` function determines whether to use local defaults or fetch from the API based purely on the presence of the `ApiToken` flag at the time of its execution.
*   The `cliLocalMode` variable within `runConfigResetLogic` (which influences `CreateConfigurationFiles` and `CliConfigFileTemplate`) is set based on `len(flags.ApiToken) == 0`.
    *   If an API token is provided to `config reset`, the resulting `.codacy/cli-config.yaml` will always be set to `mode: remote`.
    *   If no token is provided, it will be set to `mode: local`.
*   The validation logic in the `configResetCmd.Run` function occurs *before* `runConfigResetLogic` is called. This validation is responsible for:
    *   Informing the user with a console warning if `.codacy/cli-config.yaml` is missing or unparseable, then defaulting to 'local' mode for subsequent checks.
    *   Ensuring that if the (potentially defaulted) current CLI mode is "remote", an API token *must* be supplied to proceed with the reset.
    *   Ensuring that if an API token *is* supplied, then `--provider`, `--organization`, and `--repository` flags must also be supplied.

This table should cover the main operational flows and error conditions for the `config reset` command based on the implemented logic. 